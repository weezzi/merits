package com.merits.modules.base.backoffice.tables;

import java.util.Collection;

//IMPORTS -------------------------------------------------------------------------

import com.merits.modules.base.backoffice.tables.definitions.TeamTableDefinition;
import com.merits.modules.base.container.BaseContainer;
import com.merits.modules.base.dao.BulkTeamDAO;
import com.merits.modules.base.dao.TeamDAO;
import com.weezzi.core.context.TableContext;
import com.weezzi.core.data.PublishInfo;
import com.weezzi.core.data.Tree;
import com.weezzi.core.exceptions.CheckDigitsFailedException;
import com.weezzi.utils.extras.console.Console;
import com.weezzi.webserver.simel.AttributeMapper;
import com.weezzi.webserver.simel.Expression;


/**
 * <b>Title: </b> Team<br/>
 * <b>Description: </b> <br/>
 *
 * @author Auto-generated by Weezzi Builder
 * @version 1.0
 */
@SuppressWarnings("unused")
public class TeamTable extends TeamTableDefinition {



	// TABLE SPECIFIC ---------------------------------------------------------


	/**
	 * Initializes the table
	 */
	public void initializeTable() {
		// Local Variables
		
	}

	/**
	 * Wraps up table finalization
	 */
	public void finalizeTable() {
		// Local Variables
		
	}
	
	
	// ACTIONS ----------------------------------------------------------------
	
	
	/**
	 * Add Action
	 * @param context
	 */
	public void doAddAction(TableContext context, String categoryId) {
		// Local Variables
		showFormDialog("Team", null);
	}


	/**
	 * Remove Action
	 * @param context
	 * @param ids Remove row ids 
	 */
	public void doRemoveAction(TableContext context, Collection<Long> ids) {
		// Local Variables
		for(Long id : ids) {
			try {
				BaseContainer.removeTeam(id);
			} catch (Exception e) {
				// Catch Exception
				Console.error("Error remove team", e);
			}
		}
	}


	/**
	 * Copy Action
	 * @param context
	 * @param ids Copy row ids 
	 */
	public void doCopyAction(TableContext context, Collection<Long> ids) {
		// Local Variables
		
	}


	/**
	 * Move Action
	 * @param context
	 * @param sourceId Source Id
	 * @param destinationId Destination Id
	 */
	public void doMoveAction(TableContext context, String sourceId, String destinationId, String direction) {
		// Local Variables
		try {
			BaseContainer.moveTeam(decryptDataAsLong(sourceId), decryptDataAsLong(destinationId), direction);
		} catch (Exception e) {
			// Catch Exception
			Console.error("Error moving team", e);
		}
	}

	
	/**
	 * Publish Action
	 * @param context
	 * @param id Source Id
	 * @param published Published
	 */
	public boolean doPublishAction(TableContext context, String id, boolean published) {
		// Local Variables
		try {
			if (published) {
				BaseContainer.updateTeamByPublish(decryptDataAsLong(id), new PublishInfo(getBackofficeUserId()), getUpdateInfo());
			} else {
				BaseContainer.updateTeamByPublish(decryptDataAsLong(id), new PublishInfo(), getUpdateInfo());
			}
		} catch (Exception e) {
			Console.error("Error publishing team", e);
		}
		return false;
	}

	
	// RENDERS ----------------------------------------------------------------
	
	
	/**
	 * Gets data action
	 */
	public void doGetDataAction(TableContext context, int startIndex, int endIndex, String search, String categoryId) {
		// Local Variables
		BulkTeamDAO teams;
		// Get data
		try {
			teams = BaseContainer.getTeamFindByAll(getSiteDefaultLanguage());
			for(TeamDAO team : teams.data) {
				addRow(team.getId(), 
						team.getPublishInfo(), 
						team.getName(),
						team.getPhoto(),
						team.getPosition(),
						getSocialIcons(team),
						team.getMultiLangKeyTranslations(),
						team.getEditInfo());
			}
		} catch (Exception e) {
			// Catch Exception
			Console.error("Error getting teams", e);
		}
	}

	
	private String getSocialIcons(TeamDAO team) {
		// Local Variables
		Expression expr = getExpression("Icons");
		AttributeMapper map = new AttributeMapper();
		map.addAttribute("FACEBOOK", team.getFacebookUrl());
		map.addAttribute("INSTAGRAM", team.getInstagramUrl());
		map.addAttribute("TWITTER", team.getTwitterUrl());
		return expr.render(map);
	}

	/**
	 * Renders a tree
	 */
	public Tree doGetTreeAction(TableContext context) {
		// Local Variables
		return null;
	}

}

