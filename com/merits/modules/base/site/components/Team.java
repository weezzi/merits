package com.merits.modules.base.site.components;

import com.merits.modules.base.container.BaseContainer;
import com.merits.modules.base.dao.BulkTeamDAO;
import com.merits.modules.base.dao.TeamDAO;

//IMPORTS -------------------------------------------------------------------------

import com.merits.modules.base.site.components.definitions.TeamDefinition;
import com.weezzi.utils.StringUtilities;
import com.weezzi.utils.extras.console.Console;
import com.weezzi.webserver.simel.AttributeMapper;
import com.weezzi.webserver.simel.Expression;


/**
 * <b>Title: </b> Team<br/>
 * <b>Description: </b> <br/>
 *
 * @author Auto-generated by Weezzi Site Builder
 * @version 1.0
 */
public class Team extends TeamDefinition {


	// CONSTANTS ---------------------------------------------------------------

	
	// INITIALIZATION ----------------------------------------------------------
	
	
	public void customComponentInitialization() {
		addGlobalStyle("MeritsV2");
		addGlobalScript("ScriptsV2");
	};


	// BROWSER OUTPUT ----------------------------------------------------------


	/**
	 * Generate Start Output
	 * @return String
	 */
	public String getStartOutput() {
		// Local Variables
		Expression expr;
		AttributeMapper map;
		// Get Expression
		expr = getHTMLExpression("Default");
		map = expr.getAttributeMapper();		
		setDefaultMapProperties(map, getPropertiesDefinition());
		// Add attributes
		map.addAttribute("TEAM", renderMembers());
		// Render
		return expr.render(map);
	}


	private String renderMembers() {
		// Local Variables
		Expression expr;
		AttributeMapper map;
		StringBuilder buffer = new StringBuilder();
		BulkTeamDAO members;
		// Get Expression
		expr = getHTMLExpression("Person");
		map = expr.getAttributeMapper();		
		try {
			members = BaseContainer.getTeamFindByAll(getSiteLanguage());
			for(TeamDAO member : members.data) {
				if (member.getPublishInfo().isPublished()) {
					map.addAttribute("ID", encryptData(member.getId()));
					map.addAttribute("NAME", member.getName());
					map.addAttribute("DESCRIPTION", StringUtilities.replaceCRbyBR(member.getDescription()));
					map.addAttribute("PHOTO", getImage(member.getPhoto(), 500, 500));
					map.addAttribute("PHOTO_LARGE", getImage(member.getPhoto(), 800, 800));
					map.addAttribute("POSITION", member.getPosition());
					map.addAttribute("FACEBOOK", member.getFacebookUrl());
					map.addAttribute("INSTAGRAM", member.getInstagramUrl());
					map.addAttribute("TWITTER", member.getTwitterUrl());
					buffer.append(expr.render(map));
				}
			}
		} catch (Exception e) {
			// Cacth error
			Console.error("Error rendering team members", e);
		}
		// Return buffer
		return buffer.toString();
	}

	
	// PRIVATE ----------------------------------------------------------------


}

